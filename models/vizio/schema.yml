version: 2

sources:
  - name: vizio_poc_share
    database: vizio-poc-share
    schema: akkio
    tables:
      - name: production_r2079_content_with_null
        description: Raw content viewing data from Vizio devices
      - name: production_r2080_commercialfeedmodular
        description: Raw commercial/advertisement viewing data from Vizio devices
      - name: production_r2081_ipage
        description: Raw device activity and location data from Vizio devices
      - name: production_r2067_optout
        description: Device opt-out status tracking
      - name: mk_akkio_genre_title_mapping
        description: Mapping table for episode IDs to titles and genres
      - name: mk_akkio_tvtimezone_mapping
        description: Mapping table for device hashes to timezones
      - name: mk_commercialcategory_mapping
        description: Mapping table for commercial creative values to categories
      - name: nothing_bundt_cakes_attr_data_akkio_poc
        description: Attribution data for Nothing Bundt Cakes campaign
      - name: nothing_bundt_cakes_pop_data_akkio_poc
        description: TV population data by market for Nothing Bundt Cakes campaign
      - name: farm_bureau_financial_services_attr_data_akkio_poc
        description: Attribution data for Farm Bureau Financial Services campaign
      - name: farm_bureau_financial_services_pop_data_akkio_poc
        description: TV population data by market for Farm Bureau Financial Services campaign
      - name: mk_akkio_experian_demo
        description: Experian demographic data for TV devices

  - name: akkio_common
    database: akkio
    schema: akkio_common
    tables:
      - name: mac_vizio_synthetic
        description: Experian demographic and household attributes for TV devices

models:       
  - name: vizio_daily_fact_content_summary
    description: >
      Content consumption activity aggregated per given day.
      TRY to use this table instead of VIZIO_DAILY_FACT_CONTENT_DETAIL, unless this table does not contain enough detail for the query.
      | :short-name:content_consumption: :use_for_audience_gen: |<
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - PARTITION_DATE
            - AKKIO_ID
    columns:
      - name: PARTITION_DATE
        description: partition_date | :akkio-context-ignore |
      - name: VIEWED_DATE
        description: date content was viewed
        data_tests:
          - not_null
      - name: AKKIO_ID
        description: Primary device identifier from Akkio (optimized - same value as TV_ID)
        data_tests:
          - not_null
      - name: TIMEZONE
        description: Timezone of the TV device for local time conversion
      - name: ZIP_CODE
        description: Zip Code locations of Household where TV was used
      - name: DMA
        description: Designated Market Area codes where TV was used
      - name: NETWORK_STR_LIST
        description: Comma separated list of Networks viewed | :lower :space-to-hyphen :csv
      - name: CALLSIGN_STR_LIST
        description: Comma separated list of Networks callsigns viewed | :lower :space-to-hyphen :csv
      - name: TITLE_STR_LIST
        description: Comma separated list of Content titles watched | :lower :space-to-hyphen :csv
      - name: GENRE_STR_LIST
        description: Comma separated list of content Genre watched | :lower :space-to-hyphen :csv
      - name: INPUT_CATEGORY_STR_LIST
        description: Comma separated list of input device categories used | :upper :space-to-hyphen :csv
      - name: INPUT_DEVICE_STR_LIST
        description: Comma separated list of input devices used to watch content | :lower :space-to-underscore :csv
      - name: APP_SERVICE_STR_LIST
        description: Comma separated list of app services used to watch content | :lower :space-to-hyphen :csv
      - name: TOTAL_VIEWING_SECONDS
        description: Total seconds of content viewed during the day
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: vizio_daily_fact_content_detail
    description: >
      Detail Content consumption activity. This contains the same data as VIZIO_DAILY_FACT_CONTENT_SUMMARY table with ARRAY columns exploded into separate rows.
      ONLY use this table when VIZIO_DAILY_FACT_CONTENT_SUMMARY contains insufficient detail to answer the query.
      This provides granular detail about each content viewing session.
      | :short-name:content_consumption_detail: :use_for_audience_gen: |<
    columns:
      - name: PARTITION_DATE
        description: partition_date | :akkio-context-ignore |
        data_tests:
          - not_null
      - name: VIEWED_DATE
        description: date content was viewed
        data_tests:
          - not_null
      - name: AKKIO_ID
        description: Primary device identifier from Akkio (optimized - same value as TV_ID)
        data_tests:
          - not_null
      - name: ZIP_CODE
        description: Zip Code of Household where TV was last used
      - name: DMA
        description: Designated Market Area code of the viewing location
      - name: TIMEZONE
        description: Timezone of the TV device for local time conversion
      - name: NETWORK
        description: Name of the network affiliate | :lower :space-to-hyphen
      - name: CALLSIGN
        description: Call sign of the network affiliate | :lower :space-to-hyphen
      - name: PROGRAM_EPISODE_ID
        description: Episode ID of show episode or movie
      - name: TITLE
        description: Title of the show or movie name | :lower :space-to-hyphen
      - name: GENRE
        description: Comma separated list of Genres of the show/movie | :lower :space-to-hyphen :csv :all-unique-values
      - name: AIR_DATE
        description: Original air date of the content
      - name: WATCHED_LIVE
        description: If content was watched live
      - name: SESSION_START_TIME_UTC
        description: Actual start time in UTC when device started watching this content
        data_tests:
          - not_null
      - name: SESSION_END_TIME_UTC
        description: Actual end time in UTC when device stopped watching this content
        data_tests:
          - not_null
      - name: TOTAL_SECONDS
        description: total seconds this content was watched
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: INPUT_CATEGORY
        description: Category of the input device generating the data | :upper :space-to-hyphen
      - name: INPUT_DEVICE_NAME
        description: Name of the input device generating the data | :lower :space-to-underscore
      - name: APP_SERVICE
        description: Application or service used for content viewing | :lower :space-to-hyphen

  - name: vizio_daily_fact_commercial_summary
    description: >
      Advertisement (commercial) viewed activity aggregated per given day.
      TRY to use this table instead of VIZIO_DAILY_FACT_COMMERICAL_DETAIL, unless this table does not contain enough detail for the query.
      | :short-name:commercial_ad_views: :use_for_audience_gen: |<
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - PARTITION_DATE
            - AKKIO_ID
    columns:
      - name: PARTITION_DATE
        description: partition_date | :akkio-context-ignore |
        data_tests:
          - not_null
      - name: VIEWED_DATE
        description: date commercial was viewed
      - name: TIMEZONE
        description: Timezone of the TV device for local time conversion
      - name: ZIP_CODE
        description: Zip Code locations of Household where TV was used
      - name: DMA
        description: Designated Market Area codes where TV was used
      - name: CREATIVE_ID_STR_LIST
        description: Comma separated list of Creative IDs for ads viewed | :lower :space-to-hyphen :csv        
      - name: BRAND_NAME_STR_LIST
        description: Comma separated list of brands of ads viewed | :lower :space-to-hyphen :csv
      - name: AD_TITLE_STR_LIST
        description: Comma separated list of commercial ad titles viewed | :lower :space-to-hyphen :csv
      - name: COMMERCIAL_CATEGORY_STR_LIST
        description: Comma separated list of commercial categories viewed | :lower :space-to-hyphen :csv
      - name: INPUT_CATEGORY_STR_LIST
        description: Comma separated list of input device categories used | :lower :space-to-hyphen :csv
      - name: INPUT_DEVICE_STR_LIST
        description: Comma separated list of input devices used | :lower :space-to-underscore :csv
      - name: APP_SERVICE_STR_LIST
        description: Comma separated list of app services used | :lower :space-to-hyphen :csv
      - name: TOTAL_AD_VIEWS
        description: Total number of commercial views for the day
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: TOTAL_AD_SECONDS
        description: Total seconds of commercials viewed during the day
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: vizio_daily_fact_commercial_detail
    description: >
      Detail info on Advertisements (commercials) viewed on TV. This contains the same data as VIZIO_DAILY_FACT_COMMERCIAL_SUMMARY table with ARRAY columns exploded into separate rows.
      ONLY use this table when VIZIO_DAILY_FACT_COMMERCIAL_SUMMARY contains insufficient detail to answer the query.
      This provides granular detail about each commercial view including surrounding content context.
      | :short-name:commercial_ad_views_detail: :use_for_audience_gen: |<
    columns:
      - name: PARTITION_DATE
        description: partition_date | :akkio-context-ignore |
        data_tests:
          - not_null
      - name: VIEWED_DATE
        description: date commercial was viewed
        data_tests:
          - not_null
      - name: AKKIO_ID
        description: Primary device identifier from Akkio (optimized - same value as TV_ID)
        data_tests:
          - not_null
      - name: ZIP_CODE
        description: Zip Code of Household where TV was last used
      - name: DMA
        description: Designated Market Area code of the viewing location
      - name: TIMEZONE
        description: Timezone of the TV device for local time conversion
      - name: CREATIVE_ID
        description: Unique Identifier for the creative
      - name: AD_MATCH_START_TIME_UTC
        description: Actual start time in utc when device started watching the ad
        data_tests:
          - not_null
      - name: AD_MATCH_END_TIME_UTC
        description: Actual end time in utc when device stopped watching the ad
        data_tests:
          - not_null
      - name: AD_LENGTH
        description: Length of the creative in seconds
        data_tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
              severity: warn
      - name: BRAND_NAME
        description: Name of the brand of the ad | :lower :space-to-hyphen
      - name: AD_TITLE
        description: Title of the commercial ad | :lower :space-to-hyphen
      - name: COMMERCIAL_CATEGORY
        description: Category classification of the commercial | :lower :space-to-hyphen
      - name: PREV_EPISODE_ID
        description: Episode ID of content watched before the commercial
      - name: PREV_TITLE
        description: Title of content watched before the commercial | :lower :space-to-hyphen
      - name: PREV_CONTENT_START_TIME_UTC
        description: Start time of previous content in UTC
      - name: PREV_CONTENT_END_TIME_UTC
        description: End time of previous content in UTC
      - name: PREV_CALLSIGN
        description: Callsign of network for previous content | :lower :space-to-hyphen
      - name: PREV_NETWORK
        description: Network affiliate for previous content | :lower :space-to-hyphen
      - name: NEXT_EPISODE_ID
        description: Episode ID of content watched after the commercial
      - name: NEXT_TITLE
        description: Title of content watched after the commercial | :lower :space-to-hyphen
      - name: NEXT_CONTENT_START_TIME_UTC
        description: Start time of next content in UTC
      - name: NEXT_CONTENT_END_TIME_UTC
        description: End time of next content in UTC
      - name: NEXT_CALLSIGN
        description: Callsign of network for next content | :lower :space-to-hyphen
      - name: NEXT_NETWORK
        description: Network affiliate for next content | :lower :space-to-hyphen
      - name: SESSION_TYPE
        description: Viewing session type indicator
      - name: INPUT_CATEGORY
        description: Category of the input device generating the data | :lower :space-to-hyphen
      - name: INPUT_DEVICE_NAME
        description: Name of the input device generating the data | :lower :space-to-underscore
      - name: APP_SERVICE
        description: Application or service used | :lower :space-to-hyphen


  - name: vizio_daily_fact_standard_detail
    description: >
      Detail device activity and location data. This provides granular detail about each device.
      | :short-name:device_activity_detail: :use_for_audience_gen: |<
    columns:
      - name: PARTITION_DATE
        description: partition_date | :akkio-context-ignore |
        data_tests:
          - not_null
      - name: ACTIVITY_DATE
        description: date of device activity
        data_tests:
          - not_null
      - name: AKKIO_ID
        description: Primary device identifier from Akkio
        data_tests:
          - not_null
      - name: TIMEZONE
        description: Timezone of the TV device for local time conversion
      - name: TOTAL_SECONDS
        description: Total seconds of this activity session
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: CITY
        description: City where TV was active
      - name: STATE_CODE
        description: State code where TV was active
      - name: DMA
        description: Designated Market Area code of the device location
      - name: ZIP_CODE
        description: Zip Code of the device location

  - name: vizio_campaign_nothing_bundt_cakes
    description: >
      Campaign attribution data for Nothing Bundt Cakes campaign showing TV impressions and market reach.
      Use this table to analyze campaign reach, market penetration, and content context for ad impressions.
      | :short-name:campaign_attribution: :use_for_audience_gen: |<
    columns:
      - name: PARTITION_DATE
        description: partition_date | :akkio-context-ignore |
        data_tests:
          - not_null
      - name: IMPRESSION_DATE
        description: date of the ad impression
        data_tests:
          - not_null
      - name: AKKIO_ID
        description: Primary device identifier from Akkio (optimized - same value as TV_ID)
        data_tests:
          - not_null
      - name: IMPRESSION_TIMESTAMP
        description: Exact timestamp of ad impression in UTC
        data_tests:
          - not_null
      - name: TIMEZONE
        description: Timezone of the TV device for local time conversion
      - name: ZIP_CODE
        description: Zip Code of Household where impression occurred
      - name: MARKET
        description: Market name where impression occurred
      - name: CITY
        description: City where TV was active
      - name: STATE_CODE
        description: State code where TV was active
      - name: DMA
        description: Designated Market Area code of the device location          
      - name: MARKET_TV_POPULATION
        description: Total Inscape TV population in the market for reach calculations
        data_tests:
          - dbt_utils.expression_is_true:
              expression: "> 0"
              severity: warn
      - name: SHOW_TITLE
        description: Title of show during which impression occurred | :lower :space-to-hyphen
      - name: STATION_CALL_SIGN
        description: Call sign of station where impression occurred | :lower :space-to-hyphen
      - name: CHANNEL_AFFILIATE
        description: Network affiliate where impression occurred | :lower :space-to-hyphen
      - name: LOCAL_OR_NATIONAL
        description: Local or national broadcast indicator
      - name: SESSION_TYPE
        description: Type of viewing session (Live, DVR, etc.)
      - name: SESSION_SOURCE
        description: Source of the viewing session data
  
  - name: vizio_campaign_farm_bureau_financial_services
    description: >
      Campaign attribution data for Farm Bureau Financial Services campaign showing TV impressions and market reach.
      Use this table to analyze campaign reach, market penetration, and content context for ad impressions.
      | :short-name:campaign_attribution: :use_for_audience_gen: |<
    columns:
      - name: PARTITION_DATE
        description: partition_date | :akkio-context-ignore |
        data_tests:
          - not_null
      - name: IMPRESSION_DATE
        description: date of the ad impression
        data_tests:
          - not_null
      - name: AKKIO_ID
        description: Primary device identifier from Akkio (optimized - same value as TV_ID)
        data_tests:
          - not_null
      - name: IMPRESSION_TIMESTAMP
        description: Exact timestamp of ad impression in UTC
        data_tests:
          - not_null
      - name: TIMEZONE
        description: Timezone of the TV device for local time conversion
      - name: ZIP_CODE
        description: Zip Code of Household where impression occurred
      - name: MARKET
        description: Market name where impression occurred
      - name: CITY
        description: City where TV was active
      - name: STATE_CODE
        description: State code where TV was active
      - name: DMA
        description: Designated Market Area code of the device location                
      - name: MARKET_TV_POPULATION
        description: Total Inscape TV population in the market for reach calculations
        data_tests:
          - dbt_utils.expression_is_true:
              expression: "> 0"
              severity: warn
      - name: MARKET_UE_POPULATION
        description: Total UE population in the market for reach calculations
        data_tests:
          - dbt_utils.expression_is_true:
              expression: "> 0"
              severity: warn
      - name: SHOW_TITLE
        description: Title of show during which impression occurred | :lower :space-to-hyphen
      - name: STATION_CALL_SIGN
        description: Call sign of station where impression occurred | :lower :space-to-hyphen
      - name: CHANNEL_AFFILIATE
        description: Network affiliate where impression occurred | :lower :space-to-hyphen
      - name: LOCAL_OR_NATIONAL
        description: Local or national broadcast indicator
      - name: SESSION_TYPE
        description: Type of viewing session
      - name: SESSION_SOURCE
        description: Source of the viewing session data

  - name: v_akkio_attributes_latest
    description: >
      Latest demographic and household attributes from Experian for each TV device.
      This table provides decoded (non-one-hot-encoded) demographic, socioeconomic, and household composition data
      for audience segmentation, targeting, and analytics use cases. Each TV_ID has only the most recent attribute match.
      | :short-name:audience_attributes: :use_for_audience_gen: |<
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - TV_ID
    columns:
      - name: PARTITION_DATE
        description: Current date when model was run (used for table partitioning) | :akkio-context-ignore |<
        data_tests:
          - not_null
      - name: AKKIO_ID
        description: Primary device identifier from Akkio (optimized - same value as TV_ID and AKKIO_HH_ID)
        data_tests:
          - not_null
          - unique
      - name: TV_ID
        description: Device ID hash for the TV Device (joins to TV_ID in other tables, optimized - same value as AKKIO_ID)
        data_tests:
          - not_null
          - unique
      - name: AKKIO_HH_ID
        description: Household identifier from Akkio (optimized - same value as AKKIO_ID and TV_ID)
        data_tests:
          - not_null
          - unique
      - name: GENDER
        description: Gender of primary viewer | :ml-encoding-nominal |<
      - name: AGE
        description: Age of primary viewer (lower bound of age range bucket)
        data_tests:
          - dbt_utils.accepted_range:
              min_value: 18
              max_value: 100
              severity: warn
      - name: AGE_BUCKET
        description: Age range bucket code | :akkio-ml-ignore |<
      - name: EDUCATION_LEVEL
        description: Highest education level attained 
      - name: ETHNICITY
        description: Ethnicity classification | :ml-encoding-nominal |<
      - name: SPANISH_LANGUAGE
        description: Spanish language preference indicator
      - name: MARITAL_STATUS
        description: Marital status
      - name: HOME_OWNERSHIP
        description: Home ownership status
      - name: HOUSEHOLD_INCOME_K
        description: Household income in thousands (lower bound of income range)
        data_tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 500
              severity: warn
      - name: INCOME_BUCKET
        description: Income range bucket code | :akkio-ml-ignore |<
      - name: HAS_BABIES_0_3
        description: Presence of babies aged 0-3 in household
      - name: HAS_CHILDREN_0_18
        description: Presence of children aged 0-18 in household
      - name: ADULT_HOUSEHOLD_SIZE
        description: Number of adults in household
        data_tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 20
              severity: warn
      - name: MOVE_LIKELY
        description: Likelihood of household moving soon
      - name: MOVE_RECENT
        description: Recent move indicator
      - name: LOW_QUALITY_FLAG
        description: Data quality flag indicating low quality match
      - name: DEMO_INCOMPLETE_FLAG
        description: Demographic data incomplete indicator
      - name: DBT_UPDATED_AT
        description: Timestamp when record was processed by dbt | :akkio-ml-ignore |<

  - name: v_agg_akkio_ind
    description: >
      Individual-level aggregation of demographic attributes derived from v_akkio_attributes_latest.
      This table provides a simplified view with demographic data and contact identifiers.
      IPS are aggregated from all activity tables (content, commercial, standard activity, campaign attribution).
      Grain: One row per AKKIO_ID (individual device/person).
      | :short-name:individual_demographics: :use_for_audience_gen: |<
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - AKKIO_ID
    columns:
      - name: AKKIO_ID
        description: Primary device identifier from Akkio
        data_tests:
          - not_null
      - name: AKKIO_HH_ID
        description: Household identifier from Akkio (same value as AKKIO_ID in current implementation)
        data_tests:
          - not_null
      - name: WEIGHT
        description: Individual weighting factor for analytics (fixed at 11)
        data_tests:
          - not_null
          - dbt_utils.accepted_values:
              values: [11]
      - name: GENDER
        description: Gender of primary viewer
      - name: AGE
        description: Age of primary viewer (lower bound of age range bucket)
        data_tests:
          - dbt_utils.accepted_range:
              min_value: 18
              max_value: 100
              severity: warn
      - name: AGE_BUCKET
        description: Age range bucket code
      - name: ETHNICITY
        description: Ethnicity classification
      - name: EDUCATION_LEVEL
        description: Highest education level attained
      - name: MARITAL_STATUS
        description: Marital status
      - name: HOMEOWNER
        description: Home ownership status
      - name: INCOME
        description: Household income in thousands (lower bound of income range)
      - name: INCOME_BUCKET
        description: Income range bucket code
      - name: MAIDS
        description: Mobile Advertising IDs associated with individual (placeholder for future enrichment)
      - name: EMAILS
        description: Email addresses associated with individual (placeholder for future enrichment)
      - name: PHONES
        description: Phone numbers associated with individual (placeholder for future enrichment)
      - name: PARTITION_DATE
        description: partition_date derived from match_date | :akkio-context-ignore |<
        data_tests:
          - not_null

  - name: v_agg_akkio_hh
    description: >
      Household-level aggregation of demographic attributes derived from v_akkio_attributes_latest.
      This table provides household-specific attributes like home ownership and income.
      Grain: One row per AKKIO_HH_ID (household).
      | :short-name:household_demographics: :use_for_audience_gen: |<
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - AKKIO_HH_ID
    columns:
      - name: AKKIO_HH_ID
        description: Household identifier from Akkio
        data_tests:
          - not_null
          - unique
      - name: HH_WEIGHT
        description: Household weighting factor for analytics (fixed at 11)
        data_tests:
          - not_null
      - name: HOMEOWNER
        description: Home ownership status
      - name: INCOME
        description: Household income in thousands (lower bound of income range)
        data_tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 500
              severity: warn
      - name: INCOME_BUCKET
        description: Income range bucket code
      - name: PARTITION_DATE
        description: partition_date derived from match_date | :akkio-context-ignore |<
        data_tests:
          - not_null
